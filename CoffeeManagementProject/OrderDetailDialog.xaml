<Window x:Class="CoffeeManagement.OrderDetailDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="Chi Tiết Đơn Hàng"
        Height="650" Width="800"
        WindowStartupLocation="CenterScreen"
        AllowsTransparency="True" WindowStyle="None"
        Background="Transparent">

    <!-- Màu nền của Window cần trong suốt để Border chính hoạt động -->

    <Window.Resources>
        <!-- Font Family cho Icons (Nếu Font Awesome được cài đặt) -->
        <FontFamily x:Key="FontAwesome">/Fonts/#Font Awesome 6 Free Solid</FontFamily>

        <!-- Màu sắc chủ đạo (Palette) -->
        <SolidColorBrush x:Key="AccentColor" Color="#D4AF37"/>
        <SolidColorBrush x:Key="PrimaryTextColor" Color="#1C1C1C"/>
        <SolidColorBrush x:Key="SecondaryTextColor" Color="#5A5A5A"/>
        <SolidColorBrush x:Key="CardBackground" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="BorderColor" Color="#CCCCCC"/>
        <!-- Viền Tường minh hơn -->
        <SolidColorBrush x:Key="HeaderSeparatorColor" Color="#F0F0F0"/>

        <!-- Trạng thái -->
        <SolidColorBrush x:Key="StatusCompletedForeground" Color="#388E3C"/>
        <SolidColorBrush x:Key="StatusPendingForeground" Color="#FFA000"/>
        <SolidColorBrush x:Key="StatusCancelledForeground" Color="#D32F2F"/>

        <!-- DataTemplate cho mỗi Item trong Đơn hàng -->
        <DataTemplate x:Key="OrderItemDetailTemplate">
            <Border BorderBrush="{StaticResource HeaderSeparatorColor}" BorderThickness="0,0,0,1" Padding="0,8" Margin="0,0,0,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="70"/>
                        <ColumnDefinition Width="120"/>
                    </Grid.ColumnDefinitions>
                    <!-- Tên món hàng -->
                    <TextBlock Grid.Column="0" Text="{Binding MenuItem.Name}"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource PrimaryTextColor}"
                               VerticalAlignment="Center"/>
                    <!-- Dấu nhân -->
                    <TextBlock Grid.Column="1" Text="x"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource SecondaryTextColor}"
                               VerticalAlignment="Center" Margin="5,0"/>
                    <!-- Số lượng -->
                    <TextBlock Grid.Column="2" Text="{Binding Quantity}"
                               FontWeight="SemiBold"
                               TextAlignment="Right"
                               VerticalAlignment="Center"/>
                    <!-- Tổng tiền item -->
                    <TextBlock Grid.Column="3" Text="{Binding TotalPrice, StringFormat='{}{0:N0}đ'}"
                               FontWeight="Bold"
                               Foreground="{StaticResource AccentColor}"
                               TextAlignment="Right"
                               VerticalAlignment="Center"/>
                </Grid>
            </Border>
        </DataTemplate>

        <!-- Style cho TextBlock tiêu đề (Summary) -->
        <Style x:Key="SummaryLabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource SecondaryTextColor}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
        </Style>

        <!-- Style cho TextBlock giá trị (Summary) -->
        <Style x:Key="SummaryValueStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource PrimaryTextColor}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="TextAlignment" Value="Right"/>
        </Style>

    </Window.Resources>

    <!-- CONTAINER CHÍNH: Thêm Border để tạo viền cố định và màu nền cho Dialog -->
    <Border Background="{StaticResource CardBackground}" CornerRadius="15"
            BorderBrush="{StaticResource BorderColor}" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect ShadowDepth="3" Color="#000000" Opacity="0.3" BlurRadius="15"/>
        </Border.Effect>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- TIÊU ĐỀ (HEADER) -->
            <StackPanel Grid.Row="0" Margin="30,25,30,0">
                <TextBlock x:Name="TxtOrderId"
                           Text="Chi Tiết Đơn Hàng #0000"
                           FontSize="28" FontWeight="Bold"
                           Foreground="{StaticResource PrimaryTextColor}"/>

             

                
                <!-- Thông tin ngày tạo và trạng thái -->
                <StackPanel Orientation="Horizontal" Margin="0,10,0,15">
                    <TextBlock Text="" FontFamily="{StaticResource FontAwesome}"
                               Foreground="{StaticResource SecondaryTextColor}" Margin="0,0,5,0"/>
                    <TextBlock x:Name="TxtOrderDate"
                               Text="{Binding CreatedAt}"
                               Foreground="{StaticResource SecondaryTextColor}"
                               Margin="0,0,20,0"/>

                    <TextBlock x:Name="IconStatus" FontFamily="{StaticResource FontAwesome}" Margin="0,0,5,0">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value=""/>
                                <Setter Property="Foreground" Value="Gray"/>
                                <Style.Triggers>

                                    <DataTrigger Binding="{Binding Status}">
                                        <DataTrigger.Value>
                                            <sys:Byte>0</sys:Byte>
                                        </DataTrigger.Value>
                                        <Setter Property="Text" Value=""/>
                                        <Setter Property="Foreground" Value="{StaticResource StatusPendingForeground}"/>
                                    </DataTrigger>

                                    <DataTrigger Binding="{Binding Status}">
                                        <DataTrigger.Value>
                                            <sys:Byte>1</sys:Byte>
                                        </DataTrigger.Value>
                                        <Setter Property="Text" Value=""/>
                                        <Setter Property="Foreground" Value="{StaticResource StatusCompletedForeground}"/>
                                    </DataTrigger>

                                    <DataTrigger Binding="{Binding Status}">
                                        <DataTrigger.Value>
                                            <sys:Byte>4</sys:Byte>
                                        </DataTrigger.Value>
                                        <Setter Property="Text" Value=""/>
                                        <Setter Property="Foreground" Value="{StaticResource StatusCancelledForeground}"/>
                                    </DataTrigger>

                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <TextBlock x:Name="StatusTextBlock">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="Unknown"/>
                                <Setter Property="Foreground" Value="Gray"/>
                                <Style.Triggers>

                                    <DataTrigger Binding="{Binding Status}">
                                        <DataTrigger.Value>
                                            <sys:Byte>0</sys:Byte>
                                        </DataTrigger.Value>
                                        <Setter Property="Text" Value="Pending"/>
                                        <Setter Property="Foreground" Value="{StaticResource StatusPendingForeground}"/>
                                    </DataTrigger>

                                    <DataTrigger Binding="{Binding Status}">
                                        <DataTrigger.Value>
                                            <sys:Byte>1</sys:Byte>
                                        </DataTrigger.Value>
                                        <Setter Property="Text" Value="Paid"/>
                                        <Setter Property="Foreground" Value="{StaticResource StatusCompletedForeground}"/>
                                    </DataTrigger>

                                    <DataTrigger Binding="{Binding Status}">
                                        <DataTrigger.Value>
                                            <sys:Byte>4</sys:Byte>
                                        </DataTrigger.Value>
                                        <Setter Property="Text" Value="Rejected"/>
                                        <Setter Property="Foreground" Value="{StaticResource StatusCancelledForeground}"/>
                                    </DataTrigger>

                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                </StackPanel>

                <!-- Đường phân cách sau Header -->
                <Border BorderBrush="{StaticResource HeaderSeparatorColor}" BorderThickness="0,0,0,1"/>
            </StackPanel>

            <!-- NỘI DUNG CHÍNH (MAIN CONTENT) -->
            <Grid Grid.Row="1" Margin="30,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*"/>
                    <!-- Chi tiết các mục hàng -->
                    <ColumnDefinition Width="0.1*"/>
                    <!-- Khoảng trống nhỏ -->
                    <ColumnDefinition Width="2*"/>
                    <!-- Tóm tắt thanh toán -->
                </Grid.ColumnDefinitions>

                <!-- Cột 1: DANH SÁCH MỤC HÀNG (ORDER ITEMS) -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="Danh sách Sản phẩm (Items)"
                               FontSize="18" FontWeight="Bold"
                               Foreground="{StaticResource PrimaryTextColor}" Margin="0,0,0,15"/>

                    <!-- Header cho danh sách mục hàng -->
                    <Grid Margin="0,0,0,10" >
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="70"/>
                            <ColumnDefinition Width="120"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Món hàng"/>
                        <TextBlock Grid.Column="2" Text="SL" TextAlignment="Right"/>
                        <TextBlock Grid.Column="3" Text="Thành tiền" TextAlignment="Right"/>
                    </Grid>

                    <!-- List các mục hàng -->
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Height="250">
                        <ItemsControl x:Name="ItemsList" ItemTemplate="{StaticResource OrderItemDetailTemplate}"/>
                    </ScrollViewer>

                    <!-- THÔNG TIN BỔ SUNG (Ghi chú & Khách hàng) -->
                    <StackPanel Margin="0,20,0,0">
                        <TextBlock Text="Thông tin bổ sung"
                               FontSize="18" FontWeight="Bold"
                               Foreground="{StaticResource PrimaryTextColor}" Margin="0,0,0,10"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" 
                                   Style="{StaticResource SummaryLabelStyle}" Text="Khách hàng:"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" 
                                   Style="{StaticResource SummaryValueStyle}" HorizontalAlignment="Left" 
                                   Text="{Binding Customer.Username, FallbackValue='Khách lẻ'}"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" 
                                   Style="{StaticResource SummaryLabelStyle}" Text="Ghi chú:" Margin="0,5,10,0"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" 
                                   Style="{StaticResource SummaryValueStyle}" HorizontalAlignment="Left" 
                                   Text="{Binding Note, FallbackValue='Không có', TargetNullValue='Không có'}"
                                   TextWrapping="Wrap" Margin="0,5,0,0"/>
                        </Grid>
                    </StackPanel>

                </StackPanel>

                <!-- Cột 3: TÓM TẮT THANH TOÁN (PAYMENT SUMMARY) -->
                <StackPanel Grid.Column="2" Margin="25,0,0,0">
                    <TextBlock Text="Tóm tắt Thanh toán"
                               FontSize="18" FontWeight="Bold"
                               Foreground="{StaticResource PrimaryTextColor}" Margin="0,0,0,15"/>

                    <!-- Phụ phí (Giả định) -->
                    <Grid Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Style="{StaticResource SummaryLabelStyle}" Text="Phí dịch vụ:"/>
                        <TextBlock Grid.Column="1" Style="{StaticResource SummaryValueStyle}" Text="0đ"/>
                    </Grid>

                    <!-- Thuế (Giả định) -->
                    <Grid Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Style="{StaticResource SummaryLabelStyle}" Text="Thuế (VAT):"/>
                        <TextBlock Grid.Column="1" Style="{StaticResource SummaryValueStyle}" Text="0đ"/>
                    </Grid>

                    <!-- Tổng phụ -->
                    <Grid Margin="0,15,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="TỔNG CỘNG" FontWeight="Bold" FontSize="16" Foreground="{StaticResource PrimaryTextColor}"/>
                        <TextBlock Grid.Column="1" x:Name="TxtSubTotal" Text="0đ" FontWeight="Bold" FontSize="16" Foreground="{StaticResource PrimaryTextColor}"/>
                    </Grid>

                    <!-- Đường phân cách -->
                    <Border BorderBrush="{StaticResource HeaderSeparatorColor}" BorderThickness="0,0,0,1" Margin="0,15"/>

                    <!-- PHƯƠNG THỨC THANH TOÁN -->
                    

                </StackPanel>
            </Grid>

            <!-- FOOTER (CLOSE BUTTON) -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="30,20,30,25">
                <Button Content="Đóng"
                        Click="BtnClose_Click"
                        Width="120" Height="40"
                        Background="#E0E0E0"
                        Foreground="{StaticResource PrimaryTextColor}"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        FontSize="14" FontWeight="SemiBold">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="5" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#CCCCCC"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>

        </Grid>
    </Border>
</Window>
